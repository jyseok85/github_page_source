<h2 id="vscode를-활용한-springboot-환경에서-테스트-진행">vscode를 활용한 springboot 환경에서 테스트 진행</h2>
<hr />
<h3 id="1-vscode-확장-프로그램을-설치합니다">1. vscode 확장 프로그램을 설치합니다.</h3>

<ul>
  <li>Spring Boot Extension Pack
(확장 설치 후에 jdk 까지 설치 합니다. )</li>
  <li>Extension Pack for Java</li>
</ul>

<p><img src="Images/sprintbootjava.png" alt="Alt text" /></p>

<p>JDK가 설치되어 있지 않을 경우 아래의 창이 열리며, 다운받아 설치 합니다. 
<img src="Images/jdk-install.png" alt="Alt text" /></p>

<hr />
<h3 id="2-기본-프로젝트-생성">2. 기본 프로젝트 생성</h3>
<p>gradle 환경의 프로젝트를 생성하기 위해 아래 확장 설치</p>

<p><img src="Images/extension-gradle-for-java.png" alt="Alt text" /></p>

<p>F1 키를 눌러서 스프링 프로젝트 생성을 시작합니다. 
<img src="Images/K-011.png" alt="Alt text" />
<img src="Images/K-012.png" alt="Alt text" />
<img src="Images/K-013.png" alt="Alt text" />
<img src="Images/K-014.png" alt="Alt text" />
<img src="Images/K-015.png" alt="Alt text" /></p>

<hr />

<p><img src="Images/K-016.png" alt="Alt text" />
<img src="Images/K-017.png" alt="Alt text" />
<img src="Images/K-018.png" alt="Alt text" /></p>

<hr />
<h3 id="3-swagger-추가">3. Swagger 추가</h3>

<p>API 테스트를 위하여 Swagger 프레임워크를 추가합니다.</p>

<p>소스수정내역</p>
<ol>
  <li>ExampleController.java 추가 후 아래 코드 입력</li>
</ol>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.example.demo</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.swagger.v3.oas.annotations.Hidden</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.swagger.v3.oas.annotations.Parameter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.swagger.v3.oas.annotations.tags.Tag</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RestController</span><span class="o">;</span>

<span class="nd">@Tag</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"예제 API"</span><span class="o">,</span> <span class="n">description</span> <span class="o">=</span> <span class="s">"Swagger 테스트용 API"</span><span class="o">)</span>
<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExampleController</span> <span class="o">{</span>
    <span class="c1">// @Operation(summary = "문자열 반복", description = "파라미터로 받은 문자열을 2번 반복합니다.")</span>
    <span class="nd">@Parameter</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"str"</span><span class="o">,</span> <span class="n">description</span> <span class="o">=</span> <span class="s">"2번 반복할 문자열"</span><span class="o">)</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/returnStr"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">returnStr</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"str"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">str</span> <span class="o">+</span> <span class="s">"\n"</span> <span class="o">+</span> <span class="n">str</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/example"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">example</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"예시 API"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Hidden</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/ignore"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">ignore</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"무시되는 API"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ol>
  <li>application.properties 수정 (따로 추가하지 않아도 사용가능)
    <div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">springdoc.packages-to-scan</span><span class="p">=</span><span class="s">com.example.demo</span>
<span class="py">springdoc.default-consumes-media-type</span><span class="p">=</span><span class="s">application/json;charset=UTF-8</span>
<span class="py">springdoc.default-produces-media-type</span><span class="p">=</span><span class="s">application/json;charset=UTF-8</span>
<span class="py">springdoc.swagger-ui.path</span><span class="p">=</span><span class="s">/</span>
<span class="py">springdoc.swagger-ui.disable-swagger-default-url</span><span class="p">=</span><span class="s">true</span>
<span class="py">springdoc.swagger-ui.display-request-duration</span><span class="p">=</span><span class="s">true</span>
<span class="py">springdoc.swagger-ui.operations-sorter</span><span class="p">=</span><span class="s">alphaapplication</span>
</code></pre></div>    </div>
  </li>
  <li>build.gradle 에 의존성추가.
    <div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">dependencies</span> <span class="o">{</span>
 <span class="c1">//springdoc 의존성추가.</span>
 <span class="n">implementation</span> <span class="s1">'org.springdoc:springdoc-openapi-starter-webmvc-ui:2.0.2'</span> 
 <span class="o">...</span>
<span class="o">}</span>
</code></pre></div>    </div>
    <p>수정하는 내역은 아래 형광색으로 표시했습니다.</p>
  </li>
</ol>

<p><img src="Images/gradle-swagger-springdoc-project-tree.png" alt="Alt text" /></p>

<p>이후 gradle extention 에서</p>

<p>Tasks -&gt; application -&gt; bootRun 으로 실행 후 
브라우저를 실행하여 localhost:8080 으로 정상동작을 확인합니다.</p>

<p><img src="Images/K-019.png" alt="Alt text" /></p>

<p><b>※ 앞으로 서버로 실행가능한 jar 파일을 만들기 위해서는 Tasks -&gt; build -&gt; bootJar으로 빌드 합니다. </b></p>

<p><img src="Images/gradle-extension-tree.png" alt="Alt text" /></p>

<hr />
<h3 id="4-opentelemetry를-통한-grafana-tempo-자동계측-추가">4. opentelemetry를 통한 Grafana Tempo 자동계측 추가</h3>

<ol>
  <li>OpenTelemetry Instrumentation for Java 다운로드
    <ul>
      <li>깃허브 페이지 : https://github.com/open-telemetry/opentelemetry-java-instrumentation</li>
      <li>다운로드 파일 : https://github.com/open-telemetry/opentelemetry-java-instrumentation/releases</li>
    </ul>
  </li>
  <li>자바 옵션으로 다운받은 opentelemetry-javaagent-all.jar 파일 추가
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> JAVA_OPTS=-javaagent:/opentelemetry-javaagent-all.jar
</code></pre></div>    </div>
  </li>
  <li>
    <p>시스템 환경 속성 추가</p>

    <p>윈도우 : 시스템 속성 -&gt; 고급탭 -&gt; 환경변수</p>

    <p><img src="Images/K-020.png" alt="Alt text" /></p>

    <p>리눅스 : /etc/profile</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> export OTEL_EXPORTER=otlp_span
 export OTEL_EXPORTER_OTLP_ENDPOINT=https://localhost:4317
 export OTEL_EXPORTER_OTLP_INSECURE=true
 export OTEL_RESOURCE_ATTRIBUTES=service.name=SomeName
</code></pre></div>    </div>
    <p>java의 경우 사전에 환경변수등록을 하지 않을 경우 JAVA_OPTS 로 변경 불가능</p>
  </li>
  <li>자바옵션에 환경설정 내용까지 포함하여 스프링서버 실행
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> JAVA_OPTS= -javaagent:/opentelemetry-javaagent-all.jar 
 -Dotel.exporter.otlp.endpoint=http://domain:4317
 -Dotel.resource.attributes=service.name=test
</code></pre></div>    </div>
  </li>
</ol>

<p>java의 경우 닷넷과 다르게 환경변수와 옵션으로 opentelemetry 에이전트를 추가해주면 자동계층이 가능해 집니다.</p>
